{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/dealswindfall/nextjs-boilerplate/lib/supabaseAdmin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport const supabaseAdmin = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.SUPABASE_SERVICE_ROLE_KEY!, // server-only\r\n  { auth: { persistSession: false } }\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,gBAAgB,IAAA,yMAAY,gFAEvC,QAAQ,GAAG,CAAC,yBAAyB,EACrC;IAAE,MAAM;QAAE,gBAAgB;IAAM;AAAE","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/dealswindfall/nextjs-boilerplate/app/api/deals/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { supabaseAdmin } from \"@/lib/supabaseAdmin\";\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* üü¢ CREATE a new deal (POST) */\r\n/* -------------------------------------------------------------------------- */\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body = await req.json();\r\n\r\n    const oldP = parseFloat(body.old_price || body.oldPrice || 0);\r\n    const currP = parseFloat(body.current_price || body.currentPrice || 0);\r\n    const priceDiff = oldP && currP ? oldP - currP : 0;\r\n    const percentDiff = oldP ? Number(((priceDiff / oldP) * 100).toFixed(2)) : 0;\r\n\r\n    let dealLevel = \"\";\r\n    if (percentDiff >= 40 && percentDiff < 51) dealLevel = \"Blistering deal\";\r\n    else if (percentDiff >= 51 && percentDiff < 61) dealLevel = \"Scorching deal\";\r\n    else if (percentDiff >= 61 && percentDiff < 71) dealLevel = \"Searing deal\";\r\n    else if (percentDiff >= 71) dealLevel = \"Flaming deal\";\r\n\r\n    const { data, error } = await supabaseAdmin\r\n      .from(\"deals\")\r\n      .insert({\r\n        description: body.description ?? \"\",\r\n        current_price: currP || null,\r\n        old_price: oldP || null,\r\n        price_diff: priceDiff || null,\r\n        percent_diff: percentDiff || null,\r\n        image_link: body.imageLink ?? null,\r\n        product_link: body.productLink ?? null,\r\n        review_link: body.reviewLink ?? null,\r\n        coupon_code: body.couponCode ?? null,\r\n        shipping_cost: body.shippingCost ? Number(body.shippingCost) : null,\r\n        notes: body.notes ?? null,\r\n        expire_date: body.expireDate ?? null,\r\n        category: body.category ?? null,\r\n        store_name: body.storeName ?? null,\r\n        deal_level: dealLevel,\r\n\t\tholiday_tag: body.holidayTag ?? null,   // üëà NEW\r\n        published_at: new Date().toISOString(), // ‚úÖ added timestamp\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return NextResponse.json({ ok: true, deal: data }, { status: 201 });\r\n  } catch (e: any) {\r\n    console.error(\"POST /deals error:\", e);\r\n    return NextResponse.json({ error: e.message || \"Unknown error\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* üìã READ all deals (GET) */\r\n/* -------------------------------------------------------------------------- */\r\nexport async function GET() {\r\n  try {\r\n    const { data, error } = await supabaseAdmin\r\n      .from(\"deals\")\r\n      .select(\"*\")\r\n      .order(\"published_at\", { ascending: false });\r\n\r\n    if (error) throw error;\r\n    return NextResponse.json(data, { status: 200 });\r\n  } catch (e: any) {\r\n    console.error(\"GET /deals error:\", e);\r\n    return NextResponse.json({ error: e.message || \"Unknown error\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* ‚úèÔ∏è UPDATE existing deal (PUT) */\r\n/* -------------------------------------------------------------------------- */\r\nexport async function PUT(req: Request) {\r\n  try {\r\n    const body = await req.json();\r\n    const { id, ...fields } = body;\r\n\r\n    if (!id) throw new Error(\"Missing deal ID for update.\");\r\n\r\n    const { data, error } = await supabaseAdmin\r\n      .from(\"deals\")\r\n      .update(fields)\r\n      .eq(\"id\", id)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return NextResponse.json({ ok: true, updated: data });\r\n  } catch (e: any) {\r\n    console.error(\"PUT /deals error:\", e);\r\n    return NextResponse.json({ error: e.message || \"Unknown error\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* üóëÔ∏è DELETE a deal (DELETE) */\r\n/* -------------------------------------------------------------------------- */\r\nexport async function DELETE(req: Request) {\r\n  try {\r\n    const { id } = await req.json();\r\n    if (!id) throw new Error(\"Missing deal ID for delete.\");\r\n\r\n    const { error } = await supabaseAdmin.from(\"deals\").delete().eq(\"id\", id);\r\n    if (error) throw error;\r\n\r\n    return NextResponse.json({ ok: true, message: \"Deal deleted\" });\r\n  } catch (e: any) {\r\n    console.error(\"DELETE /deals error:\", e);\r\n    return NextResponse.json({ error: e.message || \"Unknown error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}